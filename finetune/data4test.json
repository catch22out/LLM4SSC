[
    {
        "task": "trans_patch",
        "patch_original": "static int lbs_ibss_join_existing(struct lbs_private *priv, struct cfg80211_ibss_params *params, struct cfg80211_bss *bss)\n{\n\tint ret = 0;\n+\tint hw, i;\n+ u8 rates_max;\n+ u8 *rates;\n\tret = lbs_set_radio(priv, preamble, 1);\n\tif (!rates_eid) {\n\t  lbs_add_rates(cmd.bss.rates);\n\t} else {\n-\t  int hw, i;\n-\t  u8 rates_max = rates_eid[1];\n-\t  u8 *rates = cmd.bss.rates;\n+\t\trates_max = rates_eid[1];\n+\t\tif (rates_max > MAX_RATES) {\n+\t\t\tlbs_deb_join(\"invalid rates\");\n+\t\t\tgoto out;\n+\t\t}\n+\t  rates = cmd.bss.rates;\n\t\tfor (hw = 0; hw < ARRAY_SIZE(lbs_rates); hw++) {\n \t\t\tu8 hw_rate = lbs_rates[hw].bitrate / 5;\n \t\t\tfor (i = 0; i < rates_max; i++) {\n\t\t\t\tif (hw_rate == (rates_eid[i+2] & 0x7f)) {\n\t\t\t\t\tu8 rate = rates_eid[i+2];\n\t\t\t\t\tif (rate == 0x02 || rate == 0x04 || rate == 0x0b || rate == 0x16)\n\t\t\t\t\t\trate |= 0x80;\n\t\t\t\t\t*rates++ = rate;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}",
        "func_before_target": "static int lbs_ibss_join_existing(struct lbs_private *priv, struct cfg80211_ibss_params *params, struct cfg80211_bss *bss)\n{\n\tint ret = 0;\n\tret = lbs_set_radio(priv, preamble, 1);\n/* placeholder: Do not delete this comment. */\n\tif (!rates_eid) {\n\t  lbs_add_rates(cmd.bss.rates);\n\t} else {\n\t\tfor (hw = 0; hw < ARRAY_SIZE(lbs_rates); hw++) {\n \t\t\tu8 hw_rate = lbs_rates[hw].bitrate / 5;\n \t\t\tfor (i = 0; i < rates_max; i++) {\n\t\t\t\tif (hw_rate == (rates_eid[i+2] & 0x7f)) {\n\t\t\t\t\tu8 rate = rates_eid[i+2];\n\t\t\t\t\tif (rate == 0x02 || rate == 0x04 || rate == 0x0b || rate == 0x16)\n\t\t\t\t\t\trate |= 0x80;\n\t\t\t\t\t*rates++ = rate;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n/* placeholder: Do not delete this comment. */\n}",
        "func_after_target": "static int lbs_ibss_join_existing(struct lbs_private *priv, struct cfg80211_ibss_params *params, struct cfg80211_bss *bss)\n{\n\tint ret = 0;\n\tint hw, i;\n\tu8 rates_max;\n\tu8 *rates;\n\tret = lbs_set_radio(priv, preamble, 1);\n/* placeholder: Do not delete this comment. */\n\tif (!rates_eid) {\n\t  lbs_add_rates(cmd.bss.rates);\n\t} else {\n\t\trates_max = rates_eid[1];\n\t\tif (rates_max > MAX_RATES) {\n\t\t\tlbs_deb_join(\"invalid rates\");\n\t\t\tgoto out;\n\t\t}\n\t\trates = cmd.bss.rates;\n\t\tfor (hw = 0; hw < ARRAY_SIZE(lbs_rates); hw++) {\n \t\t\tu8 hw_rate = lbs_rates[hw].bitrate / 5;\n \t\t\tfor (i = 0; i < rates_max; i++) {\n\t\t\t\tif (hw_rate == (rates_eid[i+2] & 0x7f)) {\n\t\t\t\t\tu8 rate = rates_eid[i+2];\n\t\t\t\t\tif (rate == 0x02 || rate == 0x04 || rate == 0x0b || rate == 0x16)\n\t\t\t\t\t\trate |= 0x80;\n\t\t\t\t\t*rates++ = rate;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n/* placeholder: Do not delete this comment. */\n}"
    }
]